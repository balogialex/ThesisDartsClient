<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MobileDartsApp.Views.MatchSummaryPage"
             x:Name="RootPage"
             Title="Összegzés"
             Shell.BackgroundColor="{DynamicResource MyBlue}"
             Shell.TitleColor="{DynamicResource MyOrange}"
             Shell.ForegroundColor="{DynamicResource MyOrange}"
             BackgroundColor="{StaticResource MyBlue}">
    
    <Shell.BackButtonBehavior>
        <BackButtonBehavior Command="{Binding NavigateToRootCommand}" />
    </Shell.BackButtonBehavior>

    <ContentPage.Resources>
        <Style x:Key="SectionTitle" TargetType="Label">
            <Setter Property="FontSize" Value="20"/>
            <Setter Property="FontAttributes" Value="Bold"/>
            <Setter Property="TextColor" Value="#12263A"/>
        </Style>

        <Style x:Key="SubtleLabel" TargetType="Label">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="TextColor" Value="#E6FFFFFF"/>
        </Style>

        <Style x:Key="MetaLabel" TargetType="Label">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="TextColor" Value="#5B6B7A"/>
        </Style>

        <Style x:Key="Card" TargetType="Border">
            <Setter Property="StrokeThickness" Value="0"/>
            <Setter Property="Background" Value="{StaticResource MyLightBlue}"/>
            <Setter Property="StrokeShape">
                <Setter.Value>
                    <RoundRectangle CornerRadius="18"/>
                </Setter.Value>
            </Setter>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="Shadow">
                <Setter.Value>
                    <Shadow Opacity="0.25" Radius="10" />
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="DarkCard" TargetType="Border" BasedOn="{StaticResource Card}">
            <Setter Property="Background">
                <Setter.Value>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                        <GradientStop Color="{StaticResource MyDeepDarkBlue}" Offset="0.0"/>
                        <GradientStop Color="#203C6B" Offset="1.0"/>
                    </LinearGradientBrush>
                </Setter.Value>
            </Setter>
            <Setter Property="Padding" Value="18"/>
        </Style>

        <Style x:Key="Chip" TargetType="Frame">
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="BackgroundColor" Value="#22FFFFFF"/>
            <Setter Property="HasShadow" Value="False"/>
            <Setter Property="CornerRadius" Value="12"/>
        </Style>

        <Style x:Key="Hairline" TargetType="BoxView">
            <Setter Property="HeightRequest" Value="1"/>
            <Setter Property="Color" Value="#1FFFFFFF"/>
            <Setter Property="Margin" Value="0,8,0,8"/>
        </Style>

        <Style x:Key="KeyValueRow" TargetType="Grid">
            <Setter Property="ColumnDefinitions" Value="*,Auto"/>
            <Setter Property="Padding" Value="8,10"/>
        </Style>

        <Style x:Key="TableHeader" TargetType="Label">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="TextColor" Value="#99FFFFFF"/>
            <Setter Property="FontAttributes" Value="Bold"/>
        </Style>

        <Style x:Key="PrimaryButton" TargetType="Button">
            <Setter Property="HeightRequest" Value="52"/>
            <Setter Property="CornerRadius" Value="14"/>
            <Setter Property="BackgroundColor" Value="#06d6a0"/>
            <Setter Property="TextColor" Value="White"/>
            <Setter Property="FontAttributes" Value="Bold"/>
        </Style>

        <Style x:Key="GhostButton" TargetType="Button">
            <Setter Property="HeightRequest" Value="52"/>
            <Setter Property="CornerRadius" Value="14"/>
            <Setter Property="BackgroundColor" Value="#1AFFFFFF"/>
            <Setter Property="TextColor" Value="White"/>
            <Setter Property="BorderColor" Value="#33FFFFFF"/>
            <Setter Property="BorderWidth" Value="1"/>
        </Style>

    </ContentPage.Resources>
    
    <ScrollView>
        <VerticalStackLayout Padding="18" Spacing="14">

            <Border Style="{StaticResource DarkCard}"
                    IsVisible="{Binding IsForfeit, Converter={StaticResource BoolToBoolConverter}}">
                <VerticalStackLayout Spacing="10">
                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12" VerticalOptions="Center" HorizontalOptions="Center">
                        <HorizontalStackLayout Spacing="4">
                            <HorizontalStackLayout Spacing="8" HorizontalOptions="Center">
                                <Image Source="trophy.png" HeightRequest="35" WidthRequest="35"/>
                                <Frame Style="{StaticResource Chip}">
                                    <Label Text="{Binding Winner}" TextColor="White" FontSize="20" VerticalOptions="Center" />
                                </Frame>
                                <Image Source="trophy.png" HeightRequest="35" WidthRequest="35"/>
                            </HorizontalStackLayout>
                        </HorizontalStackLayout>
                    </Grid>
                </VerticalStackLayout>
            </Border>
            
            <Border Style="{StaticResource DarkCard}"
                    IsVisible="{Binding IsForfeit}">
                <VerticalStackLayout Spacing="10">
                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12" VerticalOptions="Center" HorizontalOptions="Center">
                        <HorizontalStackLayout Spacing="8" HorizontalOptions="Center">
                            <Frame Style="{StaticResource Chip}">
                                <Label Text="{Binding ForfeitedBy, StringFormat='{0} feladta a meccset!'}" TextColor="White" FontSize="20" VerticalOptions="Center" />
                            </Frame>
                        </HorizontalStackLayout>
                    </Grid>
                </VerticalStackLayout>
            </Border>

            <Border Style="{StaticResource Card}">
                <VerticalStackLayout Spacing="8">
                    <Label Text="Leg-ek" Style="{StaticResource SectionTitle}"/>

                    <CollectionView ItemsSource="{Binding LegsWon}">
                        <CollectionView.EmptyView>
                            <Label Text="Nincs adat" Style="{StaticResource MetaLabel}" />
                        </CollectionView.EmptyView>
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Grid Style="{StaticResource KeyValueRow}">
                                    <Label Text="{Binding Key}" TextColor="#12263A"/>
                                    <Label Text="{Binding Value}" Grid.Column="1" TextColor="#12263A" FontAttributes="Bold"/>
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </Border>

            <Border Style="{StaticResource Card}">
                <VerticalStackLayout Spacing="8">
                    <Label Text="Átlag" Style="{StaticResource SectionTitle}"/>

                    <CollectionView ItemsSource="{Binding AveragePerVisit}">
                        <CollectionView.EmptyView>
                            <Label Text="Nincs adat" Style="{StaticResource MetaLabel}" />
                        </CollectionView.EmptyView>
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Grid Style="{StaticResource KeyValueRow}">
                                    <Label Text="{Binding Key}" TextColor="#12263A"/>
                                    <Label Text="{Binding Value, StringFormat='{0:F1}'}"
                                           Grid.Column="1" TextColor="#12263A" FontAttributes="Bold"/>
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </Border>

            <Border Style="{StaticResource Card}">
                <VerticalStackLayout Spacing="10">
                    <Label Text="Kiszállózás" Style="{StaticResource SectionTitle}"/>

                    <Label Text="Kiszálló %" Style="{StaticResource TableHeader}"/>
                    <CollectionView ItemsSource="{Binding CheckoutPercent}">
                        <CollectionView.EmptyView>
                            <Label Text="Nincs adat" Style="{StaticResource MetaLabel}" />
                        </CollectionView.EmptyView>
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Grid Style="{StaticResource KeyValueRow}">
                                    <Label Text="{Binding Key}" TextColor="#12263A"/>
                                    <Label Text="{Binding Value, StringFormat='{0}%'}"
                                           Grid.Column="1" TextColor="#12263A" FontAttributes="Bold"/>
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>

                    <BoxView HeightRequest="1" Color="#33000000" Margin="0,6,0,6"/>

                    <Grid ColumnDefinitions="*,Auto" ColumnSpacing="8" Padding="8,0">
                        <Label Text="Játékos" Style="{StaticResource TableHeader}"/>
                        <Label Text="Siker / Kísérlet" Grid.Column="1" Style="{StaticResource TableHeader}" HorizontalOptions="Center"/>
                    </Grid>

                    <CollectionView ItemsSource="{Binding CheckoutString}">
                        <CollectionView.EmptyView>
                            <Label Text="Nincs adat" Style="{StaticResource MetaLabel}" />
                        </CollectionView.EmptyView>
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Grid ColumnDefinitions="*,Auto" Padding="8,10" ColumnSpacing="8">
                                    <Label Text="{Binding Key}" TextColor="#12263A"/>
                                    <Label Text="{Binding Value}" Grid.Column="1" TextColor="#12263A" HorizontalOptions="Center"/>
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </Border>

            <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                <Button Text="Vissza a főoldalra"
                        Command="{Binding NavigateToRootCommand}"
                        Style="{StaticResource PrimaryButton}"/>
            </Grid>

            <BoxView HeightRequest="24" Opacity="0"/>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
